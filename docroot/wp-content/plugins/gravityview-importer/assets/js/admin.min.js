!function($){"use strict";var GVImport={selectFields:null,allowSubmit:!0,init:function(){GVImport.setVars(),GVImport.moveButtons(),GVImport.updateFormParameters(),$(document).on("change","#gform-settings",GVImport.updateAvailableFields).on("change","#gform-settings",GVImport.initDependentSettings).on("submit","#gform-settings",GVImport.submitSettings).on("click",GVImport.resetButton,GVImport.resetMapping).on("click",GVImport.smartButton,GVImport.smartMapping).on("click",":input[type=submit]",GVImport.addClickedAttr).on("click",".gv-importer-hide-console",GVImport.toggleConsole).on("click",".gv-complete-import",GVImport.completeImport),$("#gform-settings").trigger("change")},getFieldMapSelectByValue:function(select_value){var $option=$("#gaddon-setting-row-import_field_map").find('select option[value="'+select_value+'"]:selected');return!!($option&&$option.length>0)&&$option.parent("select")},toggleDependentSettings:function(select_value,row_id,e){var $target=$(e.target),$settings_row=$("#gaddon-setting-row-"+row_id),$select=!1;$target.is("select")?$select=$target:$target.is("form")&&($select=GVImport.getFieldMapSelectByValue(select_value)),$select&&(select_value===$select.val()?$settings_row.find("th").hide().end().find("td").attr("colspan",2).end().find("input:checkbox").attr("checked",null).end().remove().attr("data-parent-field-id",$select.attr("id")).insertAfter($select.parent("td").parent("tr")).fadeIn():$settings_row.filter('[data-parent-field-id="'+$select.attr("id")+'"]').fadeOut("fast"))},initDependentSettings:function(e){GVImport.toggleDependentSettings("post_id","overwrite_post_data",e),GVImport.toggleDependentSettings("entry_id","overwrite_entry",e)},moveButtons:function(){var $field_map=$("#gaddon-setting-row-import_field_map");$field_map.find("th button").appendTo($field_map.find("> th"))},smartMapping:function(e){e.preventDefault(),$(".settings-field-map-table").find("tr").filter(function(){return""===$("select",$(this)).val()}).each(function(){var column_label=$("td:first-child label",$(this)).text().trim().toLowerCase();$("option",$("td:last-child select",$(this))).filter(function(){return $(this).text().trim().toLowerCase()===column_label}).attr("selected","selected")})},resetMapping:function(e){e.preventDefault(),$(".settings-field-map-table select").val(""),$("#gform-settings").trigger("change"),$(this).fadeOut("fast")},addClickedAttr:function(){$(":input[type=submit]",$(this).parents("form")).removeAttr("clicked"),$(this).attr("clicked",!0)},getNotEmptySelectsLength:function(){return $(".settings-field-map-table:visible").find("tbody tr:visible").filter(function(){return""!==$("select",this).val()}).length},submitSettings:function(e){var $target=$(e.target);return $target.find("input[clicked]").hasClass("button-primary")&&(GVImport._submitEmptyFieldMap($target),GVImport._submitConfirmations()),GVImport.allowSubmit},_submitConfirmations:function(){var passed_confirmations=!0,$entry_select=GVImport.getFieldMapSelectByValue("entry_id");$entry_select&&((passed_confirmations=window.confirm(gv_importer_strings.overwrite_entry))||$entry_select.focus());var $post_select=GVImport.getFieldMapSelectByValue("post_id");$post_select&&passed_confirmations&&((passed_confirmations=window.confirm(gv_importer_strings.overwrite_posts))||$post_select.focus()),GVImport.allowSubmit=passed_confirmations},_submitEmptyFieldMap:function($target){$(".settings-field-map-table:visible").length>0&&0===GVImport.getNotEmptySelectsLength()&&(alert(gv_importer_strings.field_mapping_empty),$("#gaddon-setting-row-import_field_map").find("tr:first-child select").focus(),GVImport.allowSubmit=!1)},completeImport:function(e){e.preventDefault();var data={action:"gv_import_complete",feed_id:gv_importer_strings.feed_id,nonce:gv_importer_strings.nonce};$(e.target).html(gv_importer_strings.wrapping_up),$.post(ajaxurl,data,function(response){$(e.target).text(gv_importer_strings.complete);var url=$(e.target).attr("href");url&&"#"!==url?window.location.replace(url):window.location.reload()})},setVars:function(){GVImport.selectFields=$("#gform-settings").find("select.gaddon-select:first").clone(),GVImport.resetButton="#gform-settings button[type=reset]",GVImport.smartButton="#gform-settings button.smart-map"},updateFormParameters:function(){$(".settings-field-map-table").find("thead tr th:last-child:not(.gv-importer-col-form-field)").html(gv_importer_strings.column_header).end().find("tbody tr:odd").addClass("alt"),$("#gform-settings").attr("enctype","multipart/form-data")},toggleConsole:function(e){e.preventDefault();var $button=$(this);$(".gravityview-importer-console").slideToggle(function(){var button_text=$(this).is(":visible")?gv_importer_strings.hide_console:gv_importer_strings.show_console;$button.text(button_text)})},importerComplete:function(){$(".gravityview-importer-status.processing").fadeOut("fast",function(){$(".gravityview-importer-status.complete").fadeIn("fast")}),$(".gravityview-importer-console").animate({height:200},1e3,function(){$(".gravityview-importer-report").slideDown()})},updateAvailableFields:function(e){$("option",GVImport.selectFields).attr("disabled",null),0===GVImport.getNotEmptySelectsLength()?$(GVImport.resetButton).hide():$(GVImport.resetButton).fadeIn("fast"),$("#gform-settings").find("tr select.gaddon-select").each(function(){""!==$(this).val()&&GVImport.selectFields.find('option[value="'+$(this).val()+'"]').attr("title",gv_importer_strings.already_mapped).attr("disabled",!0)}).not(e.target).each(function(){var select=GVImport.selectFields.clone();select.val($(this).val()),select.find("option:selected").attr("disabled",null),select.attr("id",$(this).attr("id")),select.attr("name",$(this).attr("name")),$(this).replaceWith(select)})}};$(document).on("ready",GVImport.init).on("importer-complete",GVImport.importerComplete).on("importer-added",GVImport.importerAdded)}(jQuery);